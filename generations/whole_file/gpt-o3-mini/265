import tkinter as tk
from tkinter import ttk
from tkinter import colorchooser
import random  # добавлено для функции случайного цвета

def create_paint_canvas():
    root = tk.Tk()
    root.title("Painting Canvas")

    # Создать фрейм панели инструментов
    toolbar = tk.Frame(root, bd=1, relief=tk.RAISED)
    toolbar.pack(side=tk.TOP, fill=tk.X)

    # Управление размером кисти
    size_label = tk.Label(toolbar, text="Brush Size:")
    size_label.pack(side=tk.LEFT, padx=5)
    brush_size = tk.Scale(toolbar, from_=1, to=20, orient=tk.HORIZONTAL)
    brush_size.set(2)  # Размер по умолчанию
    brush_size.pack(side=tk.LEFT, padx=5)

    # Текущий цвет и выбор цвета
    current_color = tk.StringVar(value="black")
    color_display = tk.Label(toolbar, bg=current_color.get(), width=3)
    color_display.pack(side=tk.LEFT, padx=5)

    def choose_color():
        color = colorchooser.askcolor(title="Choose brush color")[1]
        if color:  # Если цвет был выбран (не отменен)
            current_color.set(color)
            color_display.config(bg=color)

    color_btn = tk.Button(toolbar, text="Choose Color", command=choose_color)
    color_btn.pack(side=tk.LEFT, padx=5)

    # Добавьте это после существующей кнопки выбора цвета
    bg_color = tk.StringVar(value="white")  # Сохранить текущий цвет фона
    bg_display = tk.Label(toolbar, bg=bg_color.get(), width=3)
    bg_display.pack(side=tk.LEFT, padx=5)

    def ereaser():
        current_color.set(bg_color.get())  # Установить цвет кисти в цвет фона
        color_display.config(bg=bg_color.get())

    # кнопка ластика
    eraser_btn = tk.Button(toolbar, text="Eraser", command=ereaser)
    eraser_btn.pack(side=tk.LEFT, padx=5)

    def choose_background():
        color = colorchooser.askcolor(title="Choose background color")[1]
        if color:
            bg_color.set(color)
            bg_display.config(bg=color)
            canvas.config(bg=color)

    bg_btn = tk.Button(toolbar, text="Background Color", command=choose_background)
    bg_btn.pack(side=tk.LEFT, padx=5)
    
    # Новая кнопка для установки случайного цвета фона
    def random_background():
        color = "#" + "".join(random.choices("0123456789ABCDEF", k=6))
        bg_color.set(color)
        bg_display.config(bg=color)
        canvas.config(bg=color)
    
    random_btn = tk.Button(toolbar, text="Random Background", command=random_background)
    random_btn.pack(side=tk.LEFT, padx=5)

    # Создать холст
    canvas = tk.Canvas(root, bg="white", width=800, height=600)
    canvas.pack(expand=tk.YES, fill=tk.BOTH)

    def clear_canvas():
        canvas.delete("all")  # Удаляет все рисунки с холста

    # Кнопка очистки холста
    clear_btn = tk.Button(toolbar, text="Clear Canvas", command=clear_canvas)
    clear_btn.pack(side=tk.LEFT, padx=5)

    def paint(event):
        size = brush_size.get()  # Получить текущий размер кисти
        x1, y1 = (event.x - size), (event.y - size)  # Вычислить верхний левый угол овала
        x2, y2 = (event.x + size), (event.y + size)  # Вычислить нижний правый угол овала
        canvas.create_oval(x1, y1, x2, y2, fill=current_color.get(), outline=current_color.get())  # Нарисовать овал на холсте текущим цветом

    canvas.bind("<B1-Motion>", paint)

    root.mainloop()

if __name__ == "__main__":
    create_paint_canvas()